{% extends "base.html" %}
{% block content %}
    <h2>Our Menu</h2>

    <div class="menu-container" style="display: flex; gap: 2rem;">
        <!-- Menu items -->
        <div class="menu-section" style="flex: 3;">
            <h3>Pizzas</h3>
            <div class="menu-grid">
                {% for pizza in pizzas %}
                <div class="menu-item" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;">
                    <h4>
                        {{ pizza.pizza_name }}
                        {% if pizza.category == "Vegetarian" %}
                            <span style="color: green;">(VG)</span>
                        {% elif pizza.category == "Vegan" %}
                            <span style="color: darkgreen;">(V)</span>
                        {% endif %}
                    </h4>
                    <p>Price: ‚Ç¨{{ pizza.final_amount() }}</p>
                    <a href="{{ url_for('main.add_to_basket', item_type='pizzas', item_id=pizza.id) }}">
                        <button type="button">Add to Basket</button>
                    </a>
                </div>
                {% endfor %}
            </div>

            <h3>Desserts</h3>
            <div class="menu-grid">
                {% for dessert in desserts %}
                <div class="menu-item" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;">
                    <h4>{{ dessert.dessert_name }}</h4>
                    <p>Price: ‚Ç¨{{ dessert.dessert_price }}</p>
                    <a href="{{ url_for('main.add_to_basket', item_type='desserts', item_id=dessert.id) }}">
                        <button type="button">Add to Basket</button>
                    </a>
                </div>
                {% endfor %}
            </div>

            <h3>Drinks</h3>
            <div class="menu-grid">
                {% for drink in drinks %}
                <div class="menu-item" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;">
                    <h4>{{ drink.drink_name }}</h4>
                    <p>Price: ‚Ç¨{{ drink.drink_price }}</p>
                    <a href="{{ url_for('main.add_to_basket', item_type='drinks', item_id=drink.id) }}">
                        <button type="button">Add to Basket</button>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Basket Sidebar -->
        <div class="basket-sidebar" style="flex: 1; border-left: 2px solid #ddd; padding: 1rem; background: #fafafa;">
            <h3 style="text-align:center; margin-bottom: 1rem;">üõí Your Basket</h3>
            {% if basket_items %}
                <ul style="list-style: none; padding: 0;">
                    {% for item in basket_items %}
                    <li style="display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding-bottom: 0.5rem; border-bottom: 1px solid #ccc;">
                        <span>
                            {{ item.qty }}√ó {{ item.name }}
                            {% if item.type == "pizzas" %}
                                {% if item.category == "Vegetarian" %}
                                    <span style="color: green;">(VG)</span>
                                {% elif item.category == "Vegan" %}
                                    <span style="color: darkgreen;">(V)</span>
                                {% endif %}
                            {% endif %}
                        </span>
                        <span>‚Ç¨{{ "%.2f"|format(item.price) }}</span>
                        <a href="{{ url_for('main.remove_from_basket', item_type=item.type, item_id=item.id) }}"
                           style="margin-left: 10px; color: red; text-decoration: none; font-size: 1.2em;">‚ùå</a>
                    </li>
                    {% endfor %}
                </ul>

                <div style="margin-top: 1rem; font-size: 1.1em;">
                    <p>Subtotal: <b>‚Ç¨{{ "%.2f"|format(subtotal) }}</b></p>

                    {% if discounts %}
                        <p>Discounts:</p>
                        <ul style="margin:0; padding-left:1.2rem;">
                            {% for d in discounts %}
                                <li>{{ d }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}

                    <p style="margin-top: 1rem; font-weight: bold;">
                        Final Total: <b>‚Ç¨{{ "%.2f"|format(final_total) }}</b>
                    </p>
                </div>

                <!-- Discount code form -->
                <form action="{{ url_for('main.menu') }}" method="post" style="margin-top: 1rem; text-align: center;">
                    <input type="text" name="discount_code" placeholder="Enter discount code">
                    <button type="submit" style="background:#007bff; color:white; padding:0.5rem 1rem; border:none; border-radius:5px; cursor:pointer;">Apply Discount</button>
                </form>

                <div style="text-align: center; margin-top: 1.5rem;">
                    <a href="{{ url_for('main.checkout') }}" style="background: #28a745; color: white; padding: 0.7rem 1.2rem; border-radius: 8px; text-decoration: none; font-weight: bold; transition: background 0.2s;">
                        ‚úÖ Checkout
                    </a>
                </div>
            {% else %}
                <p style="text-align:center; color: #555;">Basket is empty üï≥Ô∏è</p>
            {% endif %}
        </div>
    </div>

    <br>
    <a href="{{ url_for('main.home') }}"><button>‚¨Ö Back</button></a>
{% endblock %}
